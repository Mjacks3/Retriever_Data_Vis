<!DOCTYPE html>
<html>
<title>CMX AP Related UMBC Student Analysis</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<style>
#loading {
   width: 100%;
   height: 100%;
   top: 0;
   left: 0;
   position: fixed;
   display: block;
   opacity: 0.7;
   background-color: #fff;
   z-index: 99;
   text-align: center;
}

#loading-image {
  position: absolute;
  top: 100px;
  left: 240px;
  z-index: 100;
}
</style>
<!-- styles are here -->
<!--<link href="styles/style2.css" rel="stylesheet" type="text/css"> No file included yet
<link href="c3-0.5.3/c3.css" rel="stylesheet"> -->

<!-- javascript functions goes here
 <script type="text/javascript" src="fusioncharts/js/fusioncharts.js"></script>
 <script type="text/javascript" src="fusioncharts/js/themes/fusioncharts.theme.ocean.js"></script>  -->
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyBxevA7di7Avo5vGKAgPPSkJa8ud4gnI&callback=initMap&libraries=visualization"></script>
 
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>


 

<script type="text/javascript">

var glbBuilds; 
var glbTotalnts;
function initMap(start=null, end=null, startHour = 0, endHour = 1) {
  console.log("Entered InitMap Function");
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 16.5,
    center: {lat: 39.2558715, lng: -76.7118267},
    mapTypeId: 'satellite'
  });
   
   builds = cmx(start, end);
   data = dataGeneration(builds,startHour,endHour);
   
   block = data[0];
   glbTotalnts = data[1];
   
   
	heatmap = new google.maps.visualization.HeatmapLayer({
    data: getPoints(block),
    map: map  
	
	
 })
	
 changeRadius();
 changeOpacity();
 console.log("Exiting InitMap Function");
 glbBuilds = builds;

}
function getValues(){

return glbBuilds;
}
function cmx(start=null, end=null) {
	console.log("Entered CMX Function");
	var mid = "";
	
	if (start == null || end == null)
	{
		start = "to";
		end = "day";
		
	}
	else
	{
		mid = "%3B" ;
	}
    var xhttp = new XMLHttpRequest();
    var restURL= "https://cmx.noc.umbc.edu/api/analytics/v1/deviceCount?"+
        "areas=118%2C185%2C304%2C488%2C587%"+
        "2C629%2C664%2C1025%2C1193%2C1206%2C1210%2C1260%2C1357"+
        "%2C1421%2C1875%2C1880%2C1564%2C1932%2C2354%2C2376%2C2398%2C2477"+
        "%2C2690%2C2713%2C2743%2C2814%2C2915%2C2920%2C66&"+
        "timeRange=00%3A00-23%3A59&"+
        "period="+start +mid+ end+"&"+
		"granularity=hourly&"+
        "durationCategories=0-1440&"+
        "includeStationary=false&"+
        "connectionState=all&"+
        "type=deviceCount&"+
        "_=1520953855762"
        
    xhttp.open("GET",restURL, false,"admin","HiddenFortress1958");
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send();
    // Get the raw header string
    var response = JSON.parse(xhttp.responseText);
	console.log("Output");
	
	var builds; 
	builds = {};
	var ix;
	for (ix = 0; ix < response["results"].length ;ix++)
	{
		var captures;
		captures = new Array(24).fill(0);
		
		var ind;
		for (ind = 0; ind < response["results"][ix]["data"].length ;ind++)
		{
			captures[ ind % 24] = captures[ ind % 24] + response["results"][ix]["data"][ind]["value"];
		}
		builds[response["results"][ix]["area"]] = [captures];
	}
	/*
	var jack;
	jack = new Array(24).fill(0);
	console.log(jack);
	console.log( 1 % 24);
	*/
	builds['Chesapeake'].push([39.2567085,-76.7086843]);
	builds['Public Policy'].push([39.255092,-76.7094311]);
	builds['Administration'].push([39.2533135,-76.7136622]);
	builds['Library'].push([39.25623,-76.7118938]);
	builds['Biology'].push([39.2548479,-76.7122021]);
	builds['Erickson Hall'].push([39.2570091,-76.7096952]);
	builds['Chemistry'].push([39.2548812,-76.7128226]);
	
	builds['Math_Psyc'].push([39.2540944,-76.7125407]);
	builds['Academic IV'].push([39.2536036,-76.7134087]);
	builds['PAHB'].push([39.2552382,-76.7153259]);
	builds['Commons'].push([39.2549006,-76.7109555]);
	builds['Dining Hall'].push([39.255887,-76.7078899]);
	builds['Hillside'].push([39.2578306,-76.7094585]);
	builds['Susquehanna'].push([39.25553,-76.7089886]);
	
	builds['Patapsco'].push([39.2550174,-76.7064426]);
	builds['Patapsco Addition'].push([39.2552908,-76.707214]);
	builds['Engineering'].push([39.2546022,-76.7140627]);
	builds['Fine Arts'].push([39.2549059,-76.7137036]);
	
	builds['Sondheim'].push([39.2534773,-76.7128474]);
	builds['Potomac Hall'].push([39.2560987,-76.707022]);
	
	builds['Walker AVE South'].push([39.2587439,-76.7150462]);
	builds['Harbor Hall'].push([39.2572848,-76.7084016]);
	builds['Physics'].push([39.2543472,-76.7099418]);
	builds['ITE'].push([39.2538416,-76.714377]);
	builds['University Center'].push([39.2543276,-76.7133115]);
	builds['Walker AVE North'].push([39.2592171,-76.713879]);
	builds['Terrace'].push([39.2573399,-76.7112603]);
	builds['RAC'].push([39.2529955,-76.7128026]);
	builds['Westhills'].push([39.2583289,-76.71274]);
	
	console.log(builds);
	console.log(Object.keys(builds));
	console.log("Exiting CMX");
	
	return builds;
}

  function dataGeneration(builds, startHour = 0, endHour = 0) 
{

	startHour = new Number( startHour);
	endHour = new Number(endHour);
	
	//return the added block for the chart later
	
	if  ( endHour == 0 ) 
	{
		endHour = 24;
	}	

	if ( startHour > endHour ) 
	{
		alert("Invalid Time fomat");
		return[[],[]];
	}


	if (startHour == endHour) 
	{
	 startHour = 0;
	 endHour = 24;
	}
	
	

	block = [] ;
	totalCounts = [];
		for (const [key, value] of Object.entries(builds))
		{
			var totalBucket = 0;
			var timeslot;
			
			for (timeslot = startHour; timeslot < endHour; timeslot++)
			{
				totalBucket += value[0][timeslot];
			}
			
			totalCounts.push(totalBucket);
			
			var counter; 
			for (counter = 0; counter < totalBucket ; counter ++)
			{
				block.push(value[1]);
			}
			
			
		}
		console.log("Here's what's in block");
		console.log(block);
		return [block,totalCounts] ;
		

}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(63, 0, 91, 1)',
    'rgba(127, 0, 63, 1)',
    'rgba(191, 0, 31, 1)',
    'rgba(255, 0, 0, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
  heatmap.set('radius', heatmap.get('radius') ? null : 57);
}

function changeOpacity() {
  heatmap.set('opacity', heatmap.get('opacity') ? null : 0.8);
}
function getPoints(block) 
{
	pts = [];
	var ind; 
	for (ind = 0;  ind < block.length ; ind++)
	{
		pts.push( new google.maps.LatLng(block[ind][0], block[ind][1]) ) ;
	}
	return pts;
}


</script>

<body class="w3-light-grey">
<div id="loading">
  <img id="loading-image" src="images/ajax-loader.gif" alt="Loading..." />
</div>

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>
  <span class="w3-bar-item w3-right">DoitVis</span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container w3-row">
 
  
  <hr>
  <div class="w3-container">
    <h3>Retriever Data Visualization</h3>
	
  </div>
  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>

<hr>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
     <script type="text/javascript">
		
    $( function() {
    
	
		$( "#apply1" ).on( "click", function() 
		{initMap(start= startDate.value, end= EndDate.value);
		var resetCanvas = function(){
  $('bar-chart').remove(); // this is my <canvas> element
  $('#graph-container').append('<canvas id="bar-chart"><canvas>');
  canvas = document.getElementById("bar-chart");
  ctx = canvas.getContext('2d');
  ctx.canvas.width = $('#graph').width(); // resize to parent width
  ctx.canvas.height = $('#graph').height(); // resize to parent height
  var x = canvas.width/2;
  var y = canvas.height/2;
  ctx.font = '10pt Verdana';
  ctx.textAlign = 'center';
  ctx.fillText('This text is centered on the canvas', x, y);
};
            new Chart(document.getElementById("bar-chart"), {
    type: 'bar',
    data: {
      labels: Object.keys(glbBuilds),
      datasets: [
        {
          label: "Devices number",
          backgroundColor: ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6', 
      '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
      '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A', 
      '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
      '#66994D', '#B366CC', '#4D8000', '#B33300', '#00b38d',
      '#00b334', '#b30026', '#0080b3', '#80b300'],
          data: glbTotalnts
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Devices per Building'
      }
    }
})
    });

		
		$( "#apply2" ).on( "click", function() 
		{
			map = new google.maps.Map(document.getElementById('map'), {
				zoom: 16.5,
				center: {lat: 39.2558715, lng: -76.7118267},
				mapTypeId: 'satellite' });
				
			data = dataGeneration(builds,startHour= ((StartTime.value).split(":")[0] ) ,endHour= ( (EndTime.value).split(":")[0] )  );
			
			 block = data[0];
			glbTotalnts = data[1];
			
			heatmap = new google.maps.visualization.HeatmapLayer({
			data: getPoints(block),
			map: map 



				 })
				 
				changeRadius();
				changeOpacity();
	
	$('bar-chart').clear()
			 //$('#graph-container').append('<canvas id="bar-chart"><canvas>');	
    new Chart(document.getElementById("bar-chart"), {
    type: 'bar',
    data: {
      labels: Object.keys(glbBuilds),
      datasets: [
        {
          label: "Devices number",
          backgroundColor: ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6', 
      '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
      '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A', 
      '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
      '#66994D', '#B366CC', '#4D8000', '#B33300', '#00b38d',
      '#00b334', '#b30026', '#0080b3', '#80b300'],
          data: glbTotalnts
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Devices per Building'
      }
    }
})
    }

		);
		
		
		
		var spinner = $( "#spinner" ).spinner();
		$( "#apply3" ).on( "click", function() 
		{
		
		if (spinner.spinner("value") != null){
		
			map = new google.maps.Map(document.getElementById('map'), {
				zoom: 16.5,
				center: {lat: 39.2558715, lng: -76.7118267},
				mapTypeId: 'satellite' });

			data = dataGeneration(builds,spinner.spinner("value") - 1, spinner.spinner("value"));
			
			block = data[0];
			glbTotalnts = data[1];
			
			heatmap = new google.maps.visualization.HeatmapLayer({
				data: getPoints(block),
				map: map})
				
			changeRadius();
			changeOpacity();

	$('bar-chart').clear();
		//$('#graph-container').append('<canvas id="bar-chart"><canvas>');
      new Chart(document.getElementById("bar-chart"), {
    type: 'bar',
    data: {
      labels: Object.keys(glbBuilds),
      datasets: [
        {
          label: "Devices number",
          backgroundColor: ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6', 
      '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
      '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A', 
      '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
      '#66994D', '#B366CC', '#4D8000', '#B33300', '#00b38d',
      '#00b334', '#b30026', '#0080b3', '#80b300'],
          data: glbTotalnts
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Devices per Building'
      }
    }
})
				
				}
		else
		{alert("Invalid Time format");}
		
		});
		
    $('#spinner').spinner('option', 'max', 24);
    $('#spinner').spinner('option', 'min', 1);
		
	$( "button" ).button()});
		
    </script>
	

    <hr>
     
     <p> <label class = container> <h3> Date Picker </h3> </label></p>
     <div style = "margin-bottom: 5px"> &nbsp&nbsp&nbsp Start Date: &nbsp&nbsp <input type="date" id="startDate" ></div>
  <div> &nbsp&nbsp&nbsp End Date:  &nbsp&nbsp&nbsp&nbsp<input type="date" id="EndDate" ></div>

  <p>
  <button id="apply1">Generate New Date Stats</button>
</p>
 

  <hr>

	
<p><h3>	<label class = container> Filter Time of Day:</label>  </h3></p>
<p><b>
Choose a time frame 
</b></p>

	<div style = "margin-bottom: 5px"> &nbsp&nbsp&nbsp Start time: &nbsp&nbsp <br> <input type="time" id="StartTime" value="00:00:00"></div>
	<div> &nbsp&nbsp&nbsp End time:  &nbsp&nbsp&nbsp&nbsp&nbsp <br> <input type="time" id="EndTime" value="01:00:00"></div>
	
<p>
  <button id="apply2">View New Time Stats</button>
</p>
  <p><b>
  OR :
</b></p>
 
 
  <p>
 <b> <label for="spinner">Select an hour block:</label></b>
  <input id="spinner" name="value">
</p>

  <button id="apply3">View New Time Stats</button>

    <hr>
  </div>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px;margin-top:43px;">

  <!-- Header -->
  <header class="w3-container" style="padding-top:22px">
    <h5><b><i class="fa fa-dashboard"></i> My Dashboard</b></h5>
  </header>

  <div class="w3-row-padding w3-margin-bottom">
    <div class="w3-quarter">
      <div class="w3-container w3-red w3-padding-16">
        <div class="w3-left"><i class="fa fa-comment w3-xxxlarge"></i></div>
        <div class="w3-right">
          <h3>52</h3>
        </div>
        <div class="w3-clear"></div>
        <h4>Messages</h4>
      </div>
    </div>
    <div class="w3-quarter">
      <div class="w3-container w3-blue w3-padding-16">
        <div class="w3-left"><i class="fa fa-eye w3-xxxlarge"></i></div>
        <div class="w3-right">
          <h3>99</h3>
        </div>
        <div class="w3-clear"></div>
        <h4>Views</h4>
      </div>
    </div>
    <div class="w3-quarter">
      <div class="w3-container w3-teal w3-padding-16">
        <div class="w3-left"><i class="fa fa-share-alt w3-xxxlarge"></i></div>
        <div class="w3-right">
          <h3>23</h3>
        </div>
        <div class="w3-clear"></div>
        <h4>Shares</h4>
      </div>
    </div>
    <div class="w3-quarter">
      <div class="w3-container w3-orange w3-text-white w3-padding-16">
        <div class="w3-left"><i class="fa fa-users w3-xxxlarge"></i></div>
        <div class="w3-right">
          <h3>50</h3>
        </div>
        <div class="w3-clear"></div>
        <h4>Users</h4>
      </div>
    </div>
  </div>

  
    <div class="w3-panel" id="mapPanel">
      <div class="w3-row-padding" style="margin:0 -16px">
        <div class="w3-half">
          <h5>Map</h5>
         
      <div id="map" class="container" style="width:1000px;height:800px" alt="Crime map of Baltimore">
     <!-- <div id="map" class="fill" alt="Crime map of Baltimore"</div> -->
      </div>
      </div>
      </div>
      </div>
<hr>


<canvas id="bar-chart" width="600" height="350"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script type="text/javascript">
  // Bar chart
 
 
 $( function() {
 
 
  		$( "#apply4" ).on( "click", function() 
		{
		

console.log(getValues());



new Chart(document.getElementById("bar-chart"), {
    type: 'bar',
    data: {
      labels: Object.keys(glbBuilds),
      datasets: [
        {
          label: "Devices number",
          backgroundColor: ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6', 
      '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
      '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A', 
      '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
      '#66994D', '#B366CC', '#4D8000', '#B33300', '#00b38d',
      '#00b334', '#b30026', '#0080b3', '#80b300'],
          data: glbTotalnts
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Devices per Building'
      }
    }
});});

$( "button" ).button()});
</script> </script>

 <div class="w3-container">
<p>
  <button class="w3-button w3-dark-grey" id="apply4" ></i>Show Bar Chart </button>
</p>
  </div>

  <div class="w3-container">
    <h5>Countries</h5>
    <table class="w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white">
      <tr>
        <td>United States</td>
        <td>65%</td>
      </tr>
      <tr>
        <td>UK</td>
        <td>15.7%</td>
      </tr>
      <tr>
        <td>Russia</td>
        <td>5.6%</td>
      </tr>
      <tr>
        <td>Spain</td>
        <td>2.1%</td>
      </tr>
      <tr>
        <td>India</td>
        <td>1.9%</td>
      </tr>
      <tr>
        <td>France</td>
        <td>1.5%</td>
      </tr>
    </table><br>
    <button class="w3-button w3-dark-grey">More Countries  <i class="fa fa-arrow-right"></i></button>
  </div>
  <hr>
  <div class="w3-container">
    <h5>Recent Users</h5>
    <ul class="w3-ul w3-card-4 w3-white">
      <li class="w3-padding-16">
        <!--<img src="/w3images/avatar2.png" class="w3-left w3-circle w3-margin-right" style="width:35px"> No link to file -->
        <span class="w3-xlarge">Mike</span><br>
      </li>
      <li class="w3-padding-16">
        <!--<img src="/w3images/avatar5.png" class="w3-left w3-circle w3-margin-right" style="width:35px"> No link to file -->
        <span class="w3-xlarge">Jill</span><br>
      </li>
      <li class="w3-padding-16">
       <!--  <img src="/w3images/avatar6.png" class="w3-left w3-circle w3-margin-right" style="width:35px"> No link to file -->
        <span class="w3-xlarge">Jane</span><br>
      </li>
    </ul>
  </div>
  <hr>

  

  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
    <h4>FOOTER</h4>
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  </footer>

  <!-- End page content -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
    if (mySidebar.style.display === 'block') {
        mySidebar.style.display = 'none';
        overlayBg.style.display = "none";
    } else {
        mySidebar.style.display = 'block';
        overlayBg.style.display = "block";
    }
}

// Close the sidebar with the close button
function w3_close() {
    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
}
</script>

<script language="javascript" type="text/javascript">
     $(window).load(function() {
     $('#loading').hide();
  });
</script>

</body>
</html>
